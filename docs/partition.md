# 手动分区操作
手动分区分为两部分, 后端部分位于partman/目录, 它负责读取磁盘信息并执行实际的分区
操作, 通过 PartitionManager来调用; 前端部分位于ui/, 用于处理UI相关的操作, 与
后端的所有通信都是通过PartitionDelegate来完成.
 
初始时, PartitionManager在 工作线程中先扫描当前系统的所有磁盘信息,
并将结果(DeviceList)发送给PartitionDelegate, 这时, 用户就可以开发做分区操作了.
用户分区完成后, PartitionDelegate 将用户的分区操作(OperationList)发送给
PartitionManager, 后者在工作线程中执行实际的分区过程, 并将结果返回给UI线程.

分区的最小单位是MiB, 分区的起始点与结束点, 都是MiB的整数倍.

## msdos 分区表
只有在UEFI Legacy/CSM 模式下, 才可以使用msdos分区.
只有4个主分区, 为了方便扩展, 在新建分区时, 如果"逻辑分区"是可用的, 应该默认使用"逻辑分区".
当然, 用户也可以手动更改为"主分区".

### 主分区
第一个主分区(包括扩展分区)的前部, 应该预留下大约1MiB的空间, 为了GRUB可以安装大的module.

根分区或者boot分区, 不要求必须在主分区上面(windows系统相反, 它会有这个要求).
但boot分区或根分区, 应该加入boot标记.

### 扩展分区
如果在新建逻辑分区时, 没有扩展分区, 需要自动为其创建.

如果移除了所有的逻辑分区, 应该同时移除扩展分区.

扩展分区与第一个逻辑分区之间, 也应该预留约1MiB的空白, 这个是用于 Extended Partition Boot
Record. 面且, 每个逻辑分区的开头, 也应该有1MiB的空间.

如果逻辑分区是对齐到开始点的, 它离开始点要有1MiB的空白空间; 如果是对齐到结束点的, 如果它的后面
还有逻辑分区的话, 它离结束点也应该有1MiB的空白空间.


## gpt 分区表
在UEFI 或者Legacy 模式下, 都可以使用gpt分区表.

EFI 分区(ESP), 应该添加boot及esp标记. 当加入这个标记后, EFI分区的Partition GUID就改成了
标准的GUID. 
新建EFI分区的最小限制是300MiB, 但是对于已有EFI分区, 最小容量可以是100MiB.

根分区及boot分区不需要添加boot标记.


# Tips
后台开始扫描磁盘之前, 会尽可能卸载所有可卸载的分区 (Debug 模式不会卸载交换分区). 如果卸载失败,
在分区页面里, 会隐藏正在被使用的分区.

容量的单位是MiB, GiB, 但是为了保证与deepin文件管理器的统一, 现在改为MB和GB.

# 限制
如果机器的内存小于4GiB, 需要手动创建 swap 分区或者自动创建 swap 文件. 这时, 硬盘的最小容量
变成了12GiB, 而不是默认的8GiB. 这两个值都可以在配置文件里面调整.
推荐的硬盘容量是15GiB, 这个值也可以在配置文件里面调整.

当挂载点是/, /usr, /boot等的时候, 分区是要被强制格式化的, 这个列表也可以在配置文件里面修改.

根分区/ 至少要有8GiB的空间. /boot分区默认是500MiB, EFI分区默认是300MiB.